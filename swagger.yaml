openapi: 3.0.3

info:
  title: Flask Course Samples & Practice API
  version: 1.0.0
  description: |
    Course API specification for samples and practices.
    Use Swagger UI to read and try requests.
    Includes: Samples / Practice / Task Lab.

servers:
  - url: http://127.0.0.1:5000
    description: Local Flask server (run on your own machine)
  - url: https://jsonplaceholder.typicode.com
    description: JSONPlaceholder public API
  - url: https://api.agify.io
    description: Agify public API

tags:
  - name: Sample
    description: Sample endpoints (teacher demo)
  - name: Practice
    description: Practice endpoints (student exercises)
  - name: Notes
    description: Notes demo APIs
  - name: Items
    description: Item management APIs
  - name: Movies
    description: Movie watchlist APIs
  - name: Tasks V2
    description: Advanced task management APIs
  - name: Task API
    description: Lab assignment - Task Management APIs
  - name: External API
    description: Public APIs used in front-end fetch demos

paths:

  # -------------------------
  # Sample area
  # -------------------------

  /price/{price}:
    get:
      tags: [Sample]
      summary: Calculate price with tax
      parameters:
        - name: price
          in: path
          required: true
          schema:
            type: number
            format: float
          example: 100
      responses:
        "200":
          description: Price calculation result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PriceResponse"
              examples:
                sample:
                  value:
                    original_price: 100.0
                    tax_rate: 0.05
                    tax_amount: 5.0
                    total_price: 105.0
        "404":
          description: If price is not a float (route won't match)

  /method-demo:
    get:
      tags: [Sample]
      summary: Show HTTP method (GET)
      responses:
        "200":
          description: Method result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MethodResponse"
              examples:
                get:
                  value: { method: "GET" }

    post:
      tags: [Sample]
      summary: Show HTTP method (POST)
      responses:
        "200":
          description: Method result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MethodResponse"
              examples:
                post:
                  value: { method: "POST" }

  /search:
    get:
      tags: [Sample]
      summary: Query string example
      parameters:
        - name: q
          in: query
          required: false
          schema:
            type: string
          example: python
        - name: page
          in: query
          required: false
          schema:
            type: integer
          example: 2
      responses:
        "200":
          description: Search result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
              examples:
                sample:
                  value: { keyword: "python", page: 2 }

  /add:
    post:
      tags: [Sample]
      summary: Add two numbers (JSON body)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddRequest"
            examples:
              sample:
                value: { a: 10, b: 20 }
      responses:
        "200":
          description: Add result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AddResponse"
              examples:
                sample:
                  value:
                    received_json: { a: 10, b: 20 }
                    result: 30

  /login:
    post:
      tags: [Sample]
      summary: Form data example
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: "#/components/schemas/LoginFormRequest"
            examples:
              sample:
                value: { username: "alice", password: "1234" }
      responses:
        "200":
          description: Login form result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginFormResponse"
              examples:
                sample:
                  value: { username: "alice", password: "1234" }

  /headers:
    get:
      tags: [Sample]
      summary: Show request headers
      responses:
        "200":
          description: Header info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HeadersResponse"
              examples:
                sample:
                  value:
                    User-Agent: "Mozilla/5.0"
                    Content-Type: null

  /path-demo:
    get:
      tags: [Sample]
      summary: Show request path
      responses:
        "200":
          description: Path info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PathResponse"
              examples:
                sample:
                  value: { path: "/path-demo" }

  /url-demo:
    get:
      tags: [Sample]
      summary: Show full request URL
      responses:
        "200":
          description: URL info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UrlResponse"
              examples:
                sample:
                  value: { url: "http://127.0.0.1:5000/url-demo" }

  /ip:
    get:
      tags: [Sample]
      summary: Show client IP
      responses:
        "200":
          description: IP info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpResponse"
              examples:
                sample:
                  value: { client_ip: "127.0.0.1" }

  # -------------------------
  # Practice area
  # -------------------------

  /version/{v}:
    get:
      tags: [Practice]
      summary: Version check (float path parameter)
      parameters:
        - name: v
          in: path
          required: true
          schema:
            type: number
            format: float
          example: 1.5
      responses:
        "200":
          description: Version comparison result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VersionCheckResponse"
              examples:
                needUpdate:
                  value:
                    current_version: 1.5
                    latest_version: 2.0
                    need_update: true
                    message: "Please update to the latest version"
                upToDate:
                  value:
                    current_version: 2.1
                    latest_version: 2.0
                    need_update: false
                    message: "Latest Version"
        "404":
          description: If v is not a float (route won't match)

  # -------------------------
  # Task API (Lab)
  # -------------------------

  /tasks:
    get:
      tags: [Task API]
      summary: Get all tasks
      description: Return all tasks in the system.
      responses:
        "200":
          description: List of tasks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Task"
              examples:
                sample:
                  value:
                    - { id: 1, title: "Study Flask", completed: false }
                    - { id: 2, title: "Build API Spec", completed: true }

    post:
      tags: [Task API]
      summary: Create a new task
      description: Add a new task using JSON body.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TaskCreateRequest"
            examples:
              sample:
                value: { title: "Write Lab 01" }
      responses:
        "201":
          description: Task created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
              examples:
                created:
                  value: { id: 3, title: "Write Lab 01", completed: false }

  /tasks/{id}:
    get:
      tags: [Task API]
      summary: Get task by ID
      description: Retrieve a task using dynamic routing.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "200":
          description: Task found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
              examples:
                sample:
                  value: { id: 1, title: "Study Flask", completed: false }
        "404":
          description: Task not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "Task not found" }

    put:
      tags: [Task API]
      summary: Update task by ID
      description: Update an existing task using JSON body.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TaskUpdateRequest"
            examples:
              sample:
                value: { title: "Study Flask", completed: true }
      responses:
        "200":
          description: Task updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
              examples:
                updated:
                  value: { id: 1, title: "Study Flask", completed: true }
        "404":
          description: Task not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "Task not found" }

    delete:
      tags: [Task API]
      summary: Delete task by ID
      description: Delete an existing task.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "204":
          description: Task deleted successfully
        "404":
          description: Task not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "Task not found" }

  /v2/tasks:
    get:
      tags: [Tasks V2]
      summary: Get tasks (with filter)
      description: Return tasks, optionally filtered by completion status.
      parameters:
        - name: completed
          in: query
          required: false
          schema:
            type: boolean
          example: true
      responses:
        "200":
          description: Task list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskListResponse"
              examples:
                sample:
                  value:
                    total: 2
                    tasks:
                      - { id: 1, title: "Study Flask", completed: false }
                      - { id: 2, title: "Build API Spec", completed: true }

    post:
      tags: [Tasks V2]
      summary: Create a task
      description: Add a new task using JSON body.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TaskCreateRequest"
            examples:
              sample:
                value: { title: "Write Lab 01" }
      responses:
        "201":
          description: Task created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
              examples:
                created:
                  value: { id: 3, title: "Write Lab 01", completed: false }

  /v2/tasks/{id}:
    put:
      tags: [Tasks V2]
      summary: Update task status
      description: Update task completion status.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TaskStatusRequest"
            examples:
              sample:
                value: { completed: true }
      responses:
        "200":
          description: Task updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskUpdateResponse"
              examples:
                updated:
                  value:
                    message: "Task updated"
                    task: { id: 1, title: "Study Flask", completed: true }
        "404":
          description: Task not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "Task not found" }

    delete:
      tags: [Tasks V2]
      summary: Delete task
      description: Delete task by ID.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "200":
          description: Task deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskDeleteResponse"
              examples:
                deleted:
                  value: { message: "Task deleted" }
        "404":
          description: Task not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "Task not found" }

  /v2/tasks/stats:
    get:
      tags: [Tasks V2]
      summary: Get task statistics
      description: Return task completion statistics.
      responses:
        "200":
          description: Stats result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskStatsResponse"
              examples:
                sample:
                  value:
                    total: 5
                    completed: 3
                    pending: 2
                    completion_rate: 60

  # -------------------------
  # External public APIs (for fetch demos)
  # -------------------------

  /todos/{id}:
    get:
      tags: [External API]
      summary: Get a todo (JSONPlaceholder)
      description: Public test API used for GET demo.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "200":
          description: Todo item
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JsonPlaceholderTodo"
              examples:
                sample:
                  value:
                    userId: 1
                    id: 1
                    title: "delectus aut autem"
                    completed: false

  /posts:
    post:
      tags: [External API]
      summary: Create a post (JSONPlaceholder)
      description: Public test API used for POST demo.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JsonPlaceholderPostRequest"
            examples:
              sample:
                value:
                  title: "Hello"
                  body: "Practice"
                  userId: 1
      responses:
        "201":
          description: Post created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JsonPlaceholderPostResponse"
              examples:
                sample:
                  value:
                    id: 101
                    title: "Hello"
                    body: "Practice"
                    userId: 1

  /:
    get:
      tags: [External API]
      summary: Predict age by name (Agify)
      description: Public API used for practice-235 (name-to-age).
      parameters:
        - name: name
          in: query
          required: true
          schema:
            type: string
          example: tom
      responses:
        "200":
          description: Age prediction result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AgifyResponse"
              examples:
                sample:
                  value:
                    name: "tom"
                    age: 57
                    count: 123456

  /rating:
    post:
      tags: [Practice]
      summary: Submit product rating
      description: Receive a product rating (1-5) and echo back.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RatingRequest"
            examples:
              sample:
                value:
                  product: "咖啡"
                  score: 5
      responses:
        "200":
          description: Rating received
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RatingResponse"
              examples:
                sample:
                  value:
                    status: "ok"
                    received:
                      product: "咖啡"
                      score: 5

  /notes:
    post:
      tags: [Notes]
      summary: Create a note
      description: Create a simple note and return its ID.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NoteRequest"
            examples:
              sample:
                value:
                  content: "買牛奶"
      responses:
        "201":
          description: Note created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Note"
              examples:
                sample:
                  value:
                    id: 1
                    content: "買牛奶"

  /notes/{id}:
    get:
      tags: [Notes]
      summary: Get a note by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "200":
          description: Note found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Note"
              examples:
                sample:
                  value:
                    id: 1
                    content: "買牛奶"
        "404":
          description: Note not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "not found" }

  /movies:
    post:
      tags: [Movies]
      summary: Create a movie
      description: Create a movie and return its ID.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MovieRequest"
            examples:
              sample:
                value:
                  title: "Inception"
                  year: 2010
      responses:
        "201":
          description: Movie created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Movie"
              examples:
                sample:
                  value:
                    id: 1
                    title: "Inception"
                    year: 2010

  /movies/{id}:
    get:
      tags: [Movies]
      summary: Get a movie by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "200":
          description: Movie found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Movie"
              examples:
                sample:
                  value:
                    id: 1
                    title: "Inception"
                    year: 2010
        "404":
          description: Movie not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "not found" }

    put:
      tags: [Movies]
      summary: Replace a movie
      description: Replace a movie's title and year.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MovieRequest"
            examples:
              sample:
                value:
                  title: "Interstellar"
                  year: 2014
      responses:
        "200":
          description: Movie updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Movie"
              examples:
                sample:
                  value:
                    id: 1
                    title: "Interstellar"
                    year: 2014
        "404":
          description: Movie not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "not found" }

    delete:
      tags: [Movies]
      summary: Delete a movie
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "204":
          description: Movie deleted
        "404":
          description: Movie not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "not found" }

  /message:
    post:
      tags: [Sample]
      summary: Create a message
      description: Receive a name and message and echo back.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessageRequest"
            examples:
              sample:
                value:
                  name: "Tom"
                  message: "Hello"
      responses:
        "200":
          description: Message received
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
              examples:
                sample:
                  value:
                    status: "ok"
                    received:
                      name: "Tom"
                      message: "Hello"

  /items/{id}:
    put:
      tags: [Items]
      summary: Replace an item
      description: Replace an item with a new name.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemRequest"
            examples:
              sample:
                value:
                  name: "Pencil"
      responses:
        "200":
          description: Item replaced
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"
              examples:
                sample:
                  value:
                    id: 1
                    name: "Pencil"

    patch:
      tags: [Items]
      summary: Update an item
      description: Partially update an item.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemRequest"
            examples:
              sample:
                value:
                  name: "Pencil"
      responses:
        "200":
          description: Item updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"
              examples:
                sample:
                  value:
                    id: 1
                    name: "Pencil"
        "404":
          description: Item not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "not found" }

    delete:
      tags: [Items]
      summary: Delete an item
      description: Delete an item by ID.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "204":
          description: Item deleted
        "404":
          description: Item not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "not found" }
components:
  schemas:

    # -------- Sample schemas --------
    PriceResponse:
      type: object
      properties:
        original_price:
          type: number
          format: float
        tax_rate:
          type: number
          format: float
        tax_amount:
          type: number
          format: float
        total_price:
          type: number
          format: float
      required: [original_price, tax_rate, tax_amount, total_price]

    MethodResponse:
      type: object
      properties:
        method:
          type: string
      required: [method]

    SearchResponse:
      type: object
      properties:
        keyword:
          type: string
          nullable: true
        page:
          type: integer
      required: [keyword, page]

    AddRequest:
      type: object
      properties:
        a:
          type: number
        b:
          type: number
      required: [a, b]

    AddResponse:
      type: object
      properties:
        received_json:
          type: object
          additionalProperties: true
        result:
          type: number
      required: [received_json, result]

    LoginFormRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required: [username, password]

    LoginFormResponse:
      type: object
      properties:
        username:
          type: string
          nullable: true
        password:
          type: string
          nullable: true
      required: [username, password]

    HeadersResponse:
      type: object
      properties:
        User-Agent:
          type: string
          nullable: true
        Content-Type:
          type: string
          nullable: true
      required: [User-Agent, Content-Type]

    PathResponse:
      type: object
      properties:
        path:
          type: string
      required: [path]

    UrlResponse:
      type: object
      properties:
        url:
          type: string
      required: [url]

    IpResponse:
      type: object
      properties:
        client_ip:
          type: string
          nullable: true
      required: [client_ip]

    # -------- External API schemas --------
    JsonPlaceholderTodo:
      type: object
      properties:
        userId:
          type: integer
        id:
          type: integer
        title:
          type: string
        completed:
          type: boolean
      required: [userId, id, title, completed]

    JsonPlaceholderPostRequest:
      type: object
      properties:
        title:
          type: string
        body:
          type: string
        userId:
          type: integer
      required: [title, body, userId]

    JsonPlaceholderPostResponse:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        body:
          type: string
        userId:
          type: integer
      required: [id, title, body, userId]

    AgifyResponse:
      type: object
      properties:
        name:
          type: string
        age:
          type: integer
          nullable: true
        count:
          type: integer
          nullable: true
      required: [name, age, count]

    RatingRequest:
      type: object
      properties:
        product:
          type: string
        score:
          type: integer
      required: [product, score]

    RatingResponse:
      type: object
      properties:
        status:
          type: string
        received:
          type: object
          properties:
            product:
              type: string
            score:
              type: integer
          required: [product, score]
      required: [status, received]

    NoteRequest:
      type: object
      properties:
        content:
          type: string
      required: [content]

    Note:
      type: object
      properties:
        id:
          type: integer
        content:
          type: string
      required: [id, content]

    MovieRequest:
      type: object
      properties:
        title:
          type: string
        year:
          type: integer
      required: [title, year]

    Movie:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        year:
          type: integer
      required: [id, title, year]

    MessageRequest:
      type: object
      properties:
        name:
          type: string
        message:
          type: string
      required: [name, message]

    MessageResponse:
      type: object
      properties:
        status:
          type: string
        received:
          type: object
          properties:
            name:
              type: string
            message:
              type: string
          required: [name, message]
      required: [status, received]

    ItemRequest:
      type: object
      properties:
        name:
          type: string
      required: [name]

    Item:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
      required: [id, name]
    # -------- Practice schemas --------
    VersionCheckResponse:
      type: object
      properties:
        current_version:
          type: number
          format: float
        latest_version:
          type: number
          format: float
        need_update:
          type: boolean
        message:
          type: string
      required: [current_version, latest_version, need_update, message]

    # -------- Task schemas --------
    Task:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        completed:
          type: boolean
      required: [id, title, completed]

    TaskListResponse:
      type: object
      properties:
        total:
          type: integer
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/Task"
      required: [total, tasks]

    TaskUpdateResponse:
      type: object
      properties:
        message:
          type: string
        task:
          $ref: "#/components/schemas/Task"
      required: [message, task]

    TaskDeleteResponse:
      type: object
      properties:
        message:
          type: string
      required: [message]

    TaskStatsResponse:
      type: object
      properties:
        total:
          type: integer
        completed:
          type: integer
        pending:
          type: integer
        completion_rate:
          type: integer
      required: [total, completed, pending, completion_rate]

    TaskCreateRequest:
      type: object
      properties:
        title:
          type: string
      required: [title]
    TaskUpdateRequest:
      type: object
      properties:
        title:
          type: string
        completed:
          type: boolean

    TaskStatusRequest:
      type: object
      properties:
        completed:
          type: boolean
      required: [completed]

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
      required: [error]
