openapi: 3.0.3

info:
  title: Flask Course Samples & Practice API
  version: 1.0.0
  description: |
    Course API specification for samples and practices.
    Use Swagger UI to read and try requests.
    Includes: Samples / Practice / Task Lab.

servers:
  - url: http://127.0.0.1:5000
    description: Local Flask server (run on your own machine)

tags:
  - name: Sample
    description: Sample endpoints (teacher demo)
  - name: Practice
    description: Practice endpoints (student exercises)
  - name: Task API
    description: Lab assignment - Task Management APIs

paths:

  # -------------------------
  # Sample area
  # -------------------------

  /price/{price}:
    get:
      tags: [Sample]
      summary: Calculate price with tax
      parameters:
        - name: price
          in: path
          required: true
          schema:
            type: number
            format: float
          example: 100
      responses:
        "200":
          description: Price calculation result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PriceResponse"
              examples:
                sample:
                  value:
                    original_price: 100.0
                    tax_rate: 0.05
                    tax_amount: 5.0
                    total_price: 105.0
        "404":
          description: If price is not a float (route won't match)

  /method-demo:
    get:
      tags: [Sample]
      summary: Show HTTP method (GET)
      responses:
        "200":
          description: Method result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MethodResponse"
              examples:
                get:
                  value: { method: "GET" }

    post:
      tags: [Sample]
      summary: Show HTTP method (POST)
      responses:
        "200":
          description: Method result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MethodResponse"
              examples:
                post:
                  value: { method: "POST" }

  /search:
    get:
      tags: [Sample]
      summary: Query string example
      parameters:
        - name: q
          in: query
          required: false
          schema:
            type: string
          example: python
        - name: page
          in: query
          required: false
          schema:
            type: integer
          example: 2
      responses:
        "200":
          description: Search result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
              examples:
                sample:
                  value: { keyword: "python", page: 2 }

  /add:
    post:
      tags: [Sample]
      summary: Add two numbers (JSON body)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddRequest"
            examples:
              sample:
                value: { a: 10, b: 20 }
      responses:
        "200":
          description: Add result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AddResponse"
              examples:
                sample:
                  value:
                    received_json: { a: 10, b: 20 }
                    result: 30

  /login:
    post:
      tags: [Sample]
      summary: Form data example
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: "#/components/schemas/LoginFormRequest"
            examples:
              sample:
                value: { username: "alice", password: "1234" }
      responses:
        "200":
          description: Login form result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginFormResponse"
              examples:
                sample:
                  value: { username: "alice", password: "1234" }

  /headers:
    get:
      tags: [Sample]
      summary: Show request headers
      responses:
        "200":
          description: Header info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HeadersResponse"
              examples:
                sample:
                  value:
                    User-Agent: "Mozilla/5.0"
                    Content-Type: null

  /path-demo:
    get:
      tags: [Sample]
      summary: Show request path
      responses:
        "200":
          description: Path info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PathResponse"
              examples:
                sample:
                  value: { path: "/path-demo" }

  /url-demo:
    get:
      tags: [Sample]
      summary: Show full request URL
      responses:
        "200":
          description: URL info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UrlResponse"
              examples:
                sample:
                  value: { url: "http://127.0.0.1:5000/url-demo" }

  /ip:
    get:
      tags: [Sample]
      summary: Show client IP
      responses:
        "200":
          description: IP info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpResponse"
              examples:
                sample:
                  value: { client_ip: "127.0.0.1" }

  # -------------------------
  # Practice area
  # -------------------------

  /version/{v}:
    get:
      tags: [Practice]
      summary: Version check (float path parameter)
      parameters:
        - name: v
          in: path
          required: true
          schema:
            type: number
            format: float
          example: 1.5
      responses:
        "200":
          description: Version comparison result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VersionCheckResponse"
              examples:
                needUpdate:
                  value:
                    current_version: 1.5
                    latest_version: 2.0
                    need_update: true
                    message: "Please update to the latest version"
                upToDate:
                  value:
                    current_version: 2.1
                    latest_version: 2.0
                    need_update: false
                    message: "Latest Version"
        "404":
          description: If v is not a float (route won't match)

  # -------------------------
  # Task API (Lab)
  # -------------------------

  /tasks:
    get:
      tags: [Task API]
      summary: Get all tasks
      description: Return all tasks in the system.
      responses:
        "200":
          description: List of tasks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Task"
              examples:
                sample:
                  value:
                    - { id: 1, title: "Study Flask", completed: false }
                    - { id: 2, title: "Build API Spec", completed: true }

    post:
      tags: [Task API]
      summary: Create a new task
      description: Add a new task using JSON body.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TaskCreateRequest"
            examples:
              sample:
                value: { title: "Write Lab 01" }
      responses:
        "201":
          description: Task created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
              examples:
                created:
                  value: { id: 3, title: "Write Lab 01", completed: false }

  /tasks/{id}:
    get:
      tags: [Task API]
      summary: Get task by ID
      description: Retrieve a task using dynamic routing.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        "200":
          description: Task found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
              examples:
                sample:
                  value: { id: 1, title: "Study Flask", completed: false }
        "404":
          description: Task not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value: { error: "Task not found" }

components:
  schemas:

    # -------- Sample schemas --------
    PriceResponse:
      type: object
      properties:
        original_price:
          type: number
          format: float
        tax_rate:
          type: number
          format: float
        tax_amount:
          type: number
          format: float
        total_price:
          type: number
          format: float
      required: [original_price, tax_rate, tax_amount, total_price]

    MethodResponse:
      type: object
      properties:
        method:
          type: string
      required: [method]

    SearchResponse:
      type: object
      properties:
        keyword:
          type: string
          nullable: true
        page:
          type: integer
      required: [keyword, page]

    AddRequest:
      type: object
      properties:
        a:
          type: number
        b:
          type: number
      required: [a, b]

    AddResponse:
      type: object
      properties:
        received_json:
          type: object
          additionalProperties: true
        result:
          type: number
      required: [received_json, result]

    LoginFormRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required: [username, password]

    LoginFormResponse:
      type: object
      properties:
        username:
          type: string
          nullable: true
        password:
          type: string
          nullable: true
      required: [username, password]

    HeadersResponse:
      type: object
      properties:
        User-Agent:
          type: string
          nullable: true
        Content-Type:
          type: string
          nullable: true
      required: [User-Agent, Content-Type]

    PathResponse:
      type: object
      properties:
        path:
          type: string
      required: [path]

    UrlResponse:
      type: object
      properties:
        url:
          type: string
      required: [url]

    IpResponse:
      type: object
      properties:
        client_ip:
          type: string
          nullable: true
      required: [client_ip]

    # -------- Practice schemas --------
    VersionCheckResponse:
      type: object
      properties:
        current_version:
          type: number
          format: float
        latest_version:
          type: number
          format: float
        need_update:
          type: boolean
        message:
          type: string
      required: [current_version, latest_version, need_update, message]

    # -------- Task schemas --------
    Task:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        completed:
          type: boolean
      required: [id, title, completed]

    TaskCreateRequest:
      type: object
      properties:
        title:
          type: string
      required: [title]

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
      required: [error]
